terra::time(Dp0) <- indate
terra::units(Dp0) <- "Deg"
terra::longnames(Dp0) <- "peak_wave_direction"
}
params$windVortexModel == 0 & returnVerticalWind
print("hi")
UVKs_plus_dR
Ww = Sw*NA
Sw_plus_dR = Ww
srt = sqrt(UVKs_plus_dR[,1]^2+UVKs_plus_dR[,2]^2)/UVKs_plus_dR[,3]
values(Sw_plus_dR) = srt
params$windVortexModel == 0
#V_bwd <- Sw*NA
#values(V_bwd) <- terra::extract(Sw,cd_b)
V_fwd = Sw_plus_dR
V_bwd = Sw/Ks/decay
V_bwd = Sw_plus_dR*NA
values(V_bwd) = values(Sw)/values(Ks)/values(decay)
Sw
Ks
decay
values(Ksr) = Ks
Ksr = Sw_plus_dR*NA
values(Ksr) = Ks
V_bwd = Sw/Ksr/decay
# Estimate radial derivative of wind (∂V/∂r), converting spacing to km
#mean_dx_km <- dx * 111  # very rough (1 deg ≈ 111 km at equator)
#dVdr <- (V_fwd - V_bwd) / (2 * mean_dx_km)
dVdr <- (V_fwd - V_bwd) / 10
# Use existing Sw as V, and vs = Sw as surface wind approximation (approximate V + 2*vs term)
Ks = Sw*NA
values(Ks) <- UVKs[,3]
Ks = Sw*NA
values(Ks) <- UVKs[,3]
V_bwd = Sw/Ks/decay
# Estimate radial derivative of wind (∂V/∂r), converting spacing to km
#mean_dx_km <- dx * 111  # very rough (1 deg ≈ 111 km at equator)
#dVdr <- (V_fwd - V_bwd) / (2 * mean_dx_km)
dVdr <- (V_fwd - V_bwd) / 10
# Use existing Sw as V, and vs = Sw as surface wind approximation (approximate V + 2*vs term)
Vs <- V_bwd
vs <- Sw/decay
# Drag coefficient (same as in KepertWindField.cpp)
Cd <- 0.002
# Compute vertical velocity (w_inf), valid above boundary layer Kepert 2001
numerator <- Cd * Vs * (Vs + 2 * vs)
denominator <- GEO_land$f + Vs / R + dVdr
Ww <- (1 / R) * (numerator / denominator)
plot(Ww)
R
plot(R)
plot(Ww)
plot(Ww*1000)
plot(Ww*100)
# Compute vertical velocity (w_inf), valid above boundary layer Kepert 2001
numerator <- R * Cd * Vs * (Vs + 2 * vs)
denominator <- GEO_land$f + Vs / R + dVdr
Ww <- (1 / R) * (numerator / denominator)
plot(Ww)
Cd
Vs
plot(Vs)
plot(vs)
# Compute vertical velocity (w_inf), valid above boundary layer Kepert 2001
numerator <- R * Cd * Vs * (Vs + 2 * vs)
denominator <- GEO_land$f + Vs / R + dVdr
Ww <- (1 / R) * (numerator / denominator)
plot(Ww)
plot(dVdr)
# Estimate radial derivative of wind (∂V/∂r), converting spacing to km
#mean_dx_km <- dx * 111  # very rough (1 deg ≈ 111 km at equator)
#dVdr <- (V_fwd - V_bwd) / (2 * mean_dx_km)
dVdr <- (V_fwd - V_bwd) / .010
# Estimate radial derivative of wind (∂V/∂r), converting spacing to km
#mean_dx_km <- dx * 111  # very rough (1 deg ≈ 111 km at equator)
#dVdr <- (V_fwd - V_bwd) / (2 * mean_dx_km)
dVdr <- (V_fwd - V_bwd) / .010
# Use existing Sw as V, and vs = Sw as surface wind approximation (approximate V + 2*vs term)
Vs <- V_bwd
vs <- Sw/decay
# Drag coefficient (same as in KepertWindField.cpp)
Cd <- 0.002
# Compute vertical velocity (w_inf), valid above boundary layer Kepert 2001
numerator <- R * Cd * Vs * (Vs + 2 * vs)
denominator <- GEO_land$f + Vs / R + dVdr
Ww <- (1 / R) * (numerator / denominator)
plot(Ww)
# Calculate wind vortex field based on the selected model
if (params$windVortexModel == 0) {
UVKs <- with(TRACK, KepertWindField(rMax = rMax, vMax = vMax, vFm = vFms, thetaFm = thetaFms, f = f, Rlam = Rlam, VZ = VZ, surface = params$surface))
UV <- UVKs[,1:2]
Ks <- UVKs[,3]
if(returnVerticalWind){
print("hi")
Rlam_plus1_dR = Rlam #calculate the winds gradient 10 m in the outward radial direction
Rlam_plus1_dR[,1] = Rlam_plus_dR[,1]+.01 #10 metres
Rlam_plus2_dR = Rlam #calculate the winds gradient 20 m in the outward radial direction
Rlam_plus2_dR[,1] = Rlam_plus_dR[,1]+.02 #10 metres
UVKs_plus1_dR <- with(TRACK, KepertWindField(rMax = rMax, vMax = vMax, vFm = vFms, thetaFm = thetaFms, f = f, Rlam = Rlam_plus1_dR, VZ = VZ, surface = params$surface))
UVKs_plus2_dR <- with(TRACK, KepertWindField(rMax = rMax, vMax = vMax, vFm = vFms, thetaFm = thetaFms, f = f, Rlam = Rlam_plus2_dR, VZ = VZ, surface = params$surface))
}
} else if (params$windVortexModel == 1) {
UV <- with(TRACK, HubbertWindField(rMax = rMax, vFm = vFms, thetaFm = thetaFms, f = f, Rlam = Rlam, V = V, surface = params$surface))
} else if (params$windVortexModel == 2) {
UV <- with(TRACK, McConochieWindField(rMax = rMax, vMax = vMax, vFm = vFms, thetaFm = thetaFms, Rlam = Rlam, V = V, f = f, surface = params$surface))
}
print("hi")
Ww = Sw*NA
Sw_plus1_dR = Ww
Sw_plus2_dR = Ww
srt = sqrt(UVKs_plus1_dR[,1]^2+UVKs_plus1_dR[,2]^2)/UVKs_plus1_dR[,3]
values(Sw_plus1_dR) = srt
srt = sqrt(UVKs_plus2_dR[,1]^2+UVKs_plus2_dR[,2]^2)/UVKs_plus2_dR[,3]
values(Sw_plus2_dR) = srt
Sw_plus2_dR
plot(Sw_plus2_dR)
plot(Sw_plus1_dR)
UVKs_plus1_dR <- with(TRACK, KepertWindField(rMax = rMax, vMax = vMax, vFm = vFms, thetaFm = thetaFms, f = f, Rlam = Rlam_plus1_dR, VZ = VZ, surface = params$surface))
UVKs_plus1_dR
UVKs_plus1_dR[,4]
UVKs_plus1_dR = cbind(UVKs_plus1_dR,sqrt(UVKs_plus1_dR[,1]^2 + UVKs_plus1_dR[,2]^2))
UVKs_plus2_dR = cbind(UVKs_plus2_dR,sqrt(UVKs_plus2_dR[,1]^2 + UVKs_plus2_dR[,2]^2))
111000/0.02
Rlam
UVKs <- with(TRACK, KepertWindField(rMax = rMax, vMax = vMax, vFm = vFms, thetaFm = thetaFms, f = f, Rlam = Rlam, VZ = VZ, surface = params$surface))
UV <- UVKs[,1:2]
Ks <- UVKs[,3]
print("hi")
Rlam_plus1_dR = Rlam #calculate the winds gradient 10 m in the outward radial direction
Rlam_plus1_dR[,1] = Rlam[,1]+.01 #10 metres
Rlam_plus2_dR = Rlam #calculate the winds gradient 20 m in the outward radial direction
Rlam_plus2_dR[,1] = Rlam[,1]+.02 #10 metres
UVKs_plus1_dR <- with(TRACK, KepertWindField(rMax = rMax, vMax = vMax, vFm = vFms, thetaFm = thetaFms, f = f, Rlam = Rlam_plus1_dR, VZ = VZ, surface = params$surface))
UVKs_plus2_dR <- with(TRACK, KepertWindField(rMax = rMax, vMax = vMax, vFm = vFms, thetaFm = thetaFms, f = f, Rlam = Rlam_plus2_dR, VZ = VZ, surface = params$surface))
UVKs = cbind(UVKs,sqrt(UVKs[,1]^2 + UVKs[,2]^2))
UVKs_plus1_dR = cbind(UVKs_plus1_dR,sqrt(UVKs_plus1_dR[,1]^2 + UVKs_plus1_dR[,2]^2))
UVKs_plus2_dR = cbind(UVKs_plus2_dR,sqrt(UVKs_plus2_dR[,1]^2 + UVKs_plus2_dR[,2]^2))
numOnDom = function(UVKsWs1,UVKsWs2,R,f){
#Gradient wind speed
V_fwd <- UVKsWs2[,4]/UVKsWs2[,3]
V_bwd <- UVKsWs1[,4]/UVKsWs1[,3]
dVdr <- (V_fwd - V_bwd) / 10
#surface wind speed
vs <- UVKsWs1[,4]
Cd <- 0.002
numerator <- R * Cd * Vs * (Vs + 2 * vs)
denominator <- GEO_land$f + Vs / R + dVdr
return(numerator / denominator)
}
numOnDom1 <- numOnDom(UVKs,UVKs_plus1_dR,Rlam[,1])
numOnDom = function(UVKsWs1,UVKsWs2,R,f){
#Gradient wind speed
V_fwd <- UVKsWs2[,4]/UVKsWs2[,3]
V_bwd <- UVKsWs1[,4]/UVKsWs1[,3]
dVdr <- (V_fwd - V_bwd) / 10
#surface wind speed
vs <- UVKsWs1[,4]
Cd <- 0.002
numerator <- R * Cd * V_bwd * (V_bwd + 2 * vs)
denominator <- GEO_land$f + V_bwd / R + dVdr
return(numerator / denominator)
}
numOnDom1 <- numOnDom(UVKs,UVKs_plus1_dR,Rlam[,1],f = GEO_land$f)
UVKsWs1 = UVKs
UVKsWs2 = UVKs_plus1_dR
R =  Rlam[,1]
f = GEO_land$f
f
f = values(GEO_land$f)
numOnDom1 <- numOnDom(UVKs,UVKs_plus1_dR,R =  Rlam[,1],f = f)
numOnDom = function(UVKsWs1,UVKsWs2,R,f){
#Gradient wind speed
V_fwd <- UVKsWs2[,4]/UVKsWs2[,3]
V_bwd <- UVKsWs1[,4]/UVKsWs1[,3]
dVdr <- (V_fwd - V_bwd) / 10
#surface wind speed
vs <- UVKsWs1[,4]
Cd <- 0.002
numerator <- R * Cd * V_bwd * (V_bwd + 2 * vs)
denominator <- f + V_bwd / R + dVdr
return(numerator / denominator)
}
f = values(GEO_land$f)
numOnDom1 <- numOnDom(UVKs,UVKs_plus1_dR,R =  Rlam[,1],f = f)
numOnDom2 <- numOnDom(UVKs_plus1_dR,UVKs_plus2_dR,Rlam_plus1_dR[,1],f = f)
Ww = 1/Rlam[,1] * (numOnDom2-numOnDom1) / 10
Wm2 =  GEO_land["lons"] / GEO_land["lons"]
values(Wm2) <- Ww
plot(Wm2)
Rlam[,1]
numOnDom2
(numOnDom2-numOnDom1
_
(numOnDom2-numOnDom1)
(numOnDom2-numOnDom1)/10
(numOnDom2-numOnDom1)/0.01
numOnDom = function(UVKsWs1,UVKsWs2,R,f){
#Gradient wind speed
V_fwd <- UVKsWs2[,4]/UVKsWs2[,3]
V_bwd <- UVKsWs1[,4]/UVKsWs1[,3]
dVdr <- (V_fwd - V_bwd) / 0.01
#surface wind speed
vs <- UVKsWs1[,4]
Cd <- 0.002
numerator <- R * Cd * V_bwd * (V_bwd + 2 * vs)
denominator <- f + V_bwd / R + dVdr
return(numerator / denominator)
}
f = values(GEO_land$f)
numOnDom1 <- numOnDom(UVKs,UVKs_plus1_dR,R =  Rlam[,1],f = f)
numOnDom2 <- numOnDom(UVKs_plus1_dR,UVKs_plus2_dR,Rlam_plus1_dR[,1],f = f)
VertWind = (1/Rlam[,1]) * (numOnDom2-numOnDom1) / 0.01
Ws <- GEO_land["lons"] / GEO_land["lons"]
values(Ws) <- VertWind
plot(VertWind)
Ws <- GEO_land["lons"] / GEO_land["lons"]
values(Ws) <- VertWind
plot(Ws)
numOnDom = function(UVKsWs1,UVKsWs2,R,f){
#Gradient wind speed
V_fwd <- UVKsWs2[,4]/UVKsWs2[,3]
V_bwd <- UVKsWs1[,4]/UVKsWs1[,3]
dVdr <- (V_fwd - V_bwd) / 10
#surface wind speed
vs <- UVKsWs1[,4]
Cd <- 0.002
numerator <- R * Cd * V_bwd * (V_bwd + 2 * vs)
denominator <- f + V_bwd / R + dVdr
return(numerator / denominator)
}
f = values(GEO_land$f)
numOnDom1 <- numOnDom(UVKs,UVKs_plus1_dR,R =  Rlam[,1]*1000,f = f)
numOnDom2 <- numOnDom(UVKs_plus1_dR,UVKs_plus2_dR,Rlam_plus1_dR[,1]*1000,f = f)
VertWind = (1/Rlam[,1]*1000) * (numOnDom2-numOnDom1) / 10
Ws <- GEO_land["lons"] / GEO_land["lons"]
values(Ws) <- VertWind
plot(Ws)
values(Ws) <- numOnDom1
plot(Ws)
numOnDom1 <- numOnDom(UVKs,UVKs_plus1_dR,R =  Rlam[,1],f = f)
Ws <- GEO_land["lons"] / GEO_land["lons"]
values(Ws) <- numOnDom1
plot(Ws)
f = values(GEO_land$f)
numOnDom1 <- numOnDom(UVKs,UVKs_plus1_dR,R =  Rlam[,1],f = f)
numOnDom2 <- numOnDom(UVKs_plus1_dR,UVKs_plus2_dR,Rlam_plus1_dR[,1],f = f)
Ws <- GEO_land["lons"] / GEO_land["lons"]
values(Ws) <- numOnDom1
values(Ws) <- numOnDom2
plot(Ws)
VertWind = (1/Rlam[,1]*1000) * (numOnDom2-numOnDom1) / 10
Ws <- GEO_land["lons"] / GEO_land["lons"]
values(Ws) <- numOnDom2-numOnDom1
plot(Ws)
Ws <- GEO_land["lons"] / GEO_land["lons"]
values(Ws) <- 1/Rlam[,1]
plot(Ws)
values(Ws) <- UVKs_plus1_dR[,4]
plot(Ws)
values(Ws) <- UVKs_plus2_dR[,4]
plot(Ws)
values(Ws) <- UVKs_plus2_dR[,4]-UVKs_plus2_dR[,3]
plot(Ws)
values(Ws) <- UVKs_plus2_dR[,4]-UVKs_plus1_dR[,4]
plot(Ws)
values(Ws) <- UVKs_plus2_dR[,4]-UVKs[,4]
plot(Ws)
library(Rcpp)
sourceCpp("src/verticalWind.cpp")   # compiles and loads
UVKsw <- KepertVerticalWindField(
rMax, vMax, vFms, thetaFms, f,
Rlam, VZ, surface = params$surface,
dr_m = 10.0
)
UVKs_plus2_dR <- with(TRACK, KepertVerticalWindField(
rMax = rMax, vMax = vMax, vFm = vFms, thetaFm = thetaFms, f = f,
Rlam = Rlam_plus2_dR, VZ = VZ, surface = params$surface,
dr_m = 10.0  # optional; defaults to 10 m
))
Ws <- GEO_land["lons"] / GEO_land["lons"]
values(Ws) <- UVKs_plus2_dR[,4]
plot(Ws)
plot(Ws,range = c(-10,10))
plot(Ws,range = c(-100,100))
plot(Ws,range = c(0,100))
plot(Ws,range = c(-100,100))
library(Rcpp)
sourceCpp("verticalWind.cpp")
UVKs_plus2_dR <- with(TRACK, KepertVerticalWindField(
rMax = rMax, vMax = vMax, vFm = vFms, thetaFm = thetaFms, f = f,
Rlam = Rlam_plus2_dR, VZ = VZ, surface = params$surface,
dr_m = 100.0  # optional; defaults to 10 m
))
Ws <- GEO_land["lons"] / GEO_land["lons"]
values(Ws) <- UVKs_plus2_dR[,4]
plot(Ws,range = c(-100,100))
UVKs_plus2_dR <- with(TRACK, KepertVerticalWindField(
rMax = rMax, vMax = vMax, vFm = vFms, thetaFm = thetaFms, f = f,
Rlam = Rlam, VZ = VZ, surface = params$surface,
dr_m = 100.0  # optional; defaults to 10 m
))
Ws <- GEO_land["lons"] / GEO_land["lons"]
values(Ws) <- UVKs_plus2_dR[,4]
plot(Ws,range = c(-100,100))
values(Ws) <- UVKs_plus2_dR[,3]
plot(Ws,range = c(-100,100))
plot(Ws)#,range = c(-100,100))
values(Ws) <- UVKs_plus2_dR[,1]
plot(Ws)#,range = c(-100,100))
values(Ws) <- UVKs_plus2_dR[,4]
plot(Ws)#,range = c(-100,100))
values(Ws) <- log(UVKs_plus2_dR[,4])
plot(Ws)#,range = c(-100,100))
UVKsWs <- with(TRACK, KepertVerticalWindField(
rMax = rMax, vMax = vMax, vFm = vFms, thetaFm = thetaFms, f = f,
Rlam = Rlam, VZ = VZ, surface = params$surface,
dr_m = 10.0  # optional; defaults to 10 m
))
Ws <- GEO_land["lons"] / GEO_land["lons"]
values(Ws) <- log(v[,4])
Ws <- GEO_land["lons"] / GEO_land["lons"]
values(Ws) <- log(UVKsWs[,4])
plot(Ws)#,range = c(-100,100))
sourceCpp("verticalWind.cpp")
sourceCpp("verticalWind.cpp")
UVKsWs <- with(TRACK, KepertVerticalWindField(
rMax = rMax, vMax = vMax, vFm = vFms, thetaFm = thetaFms, f = f,
Rlam = Rlam, VZ = VZ, surface = params$surface,
dr_m = 10.0  # optional; defaults to 10 m
))
Ws <- GEO_land["lons"] / GEO_land["lons"]
values(Ws) <- log(UVKsWs[,4])
plot(Ws)#,range = c(-100,100))
values(Ws) <- (UVKsWs[,4])
plot(Ws)#,range = c(-100,100))
values(Ws) <- -(UVKsWs[,4])
plot(Ws)#,range = c(-100,100))
values(Ws) <- (UVKsWs[,4])
plot(Ws)#,range = c(-100,100))
f
sourceCpp("verticalWind.cpp")
UVKsWs <- with(TRACK, KepertVerticalWindField(
rMax = rMax, vMax = vMax, vFm = vFms, thetaFm = thetaFms, f = f,
Rlam = Rlam, VZ = VZ, surface = params$surface,
dr_m = 10.0  # optional; defaults to 10 m
))
Ws <- GEO_land["lons"] / GEO_land["lons"]
values(Ws) <- -(UVKsWs[,4])
plot(Ws)#,range = c(-100,100))
sourceCpp("verticalWind.cpp")
sourceCpp("verticalWind.cpp")
UVKsWs <- with(TRACK, KepertVerticalWindField(
rMax = rMax, vMax = vMax, vFm = vFms, thetaFm = thetaFms, f = f,
Rlam = Rlam, VZ = VZ, surface = params$surface,
dr_m = 50.0  # optional; defaults to 10 m
))
Ws <- GEO_land["lons"] / GEO_land["lons"]
values(Ws) <- -(UVKsWs[,4])
plot(Ws)#,range = c(-100,100))
sourceCpp("verticalWind.cpp")
sourceCpp("verticalWind.cpp")
UVKsWs <- with(TRACK, KepertVerticalWindField(
rMax = rMax, vMax = vMax, vFm = vFms, thetaFm = thetaFms, f = f,
Rlam = Rlam, VZ = VZ, surface = params$surface,
dr_m = 50.0  # optional; defaults to 10 m
))
Ws <- GEO_land["lons"] / GEO_land["lons"]
values(Ws) <- -(UVKsWs[,4])
plot(Ws)#,range = c(-100,100))
sourceCpp("verticalWind.cpp")
UVKsWs <- with(TRACK, KepertVerticalWindField(
rMax = rMax, vMax = vMax, vFm = vFms, thetaFm = thetaFms, f = f,
Rlam = Rlam, VZ = VZ, surface = params$surface,
dr_m = 50.0  # optional; defaults to 10 m
))
Ws <- GEO_land["lons"] / GEO_land["lons"]
values(Ws) <- -(UVKsWs[,4])
plot(Ws)#,range = c(-100,100))
sourceCpp("verticalWind.cpp")
UVKsWs <- with(TRACK, KepertVerticalWindField(
rMax = rMax, vMax = vMax, vFm = vFms, thetaFm = thetaFms, f = f,
Rlam = Rlam, VZ = VZ, surface = params$surface,
dr_m = 50.0  # optional; defaults to 10 m
))
Ws <- GEO_land["lons"] / GEO_land["lons"]
values(Ws) <- -(UVKsWs[,4])
plot(Ws)#,range = c(-100,100))
Rcpp::sourceCpp("verticalWind.cpp")
sourceCpp("verticalWind.cpp")
UVKsWs <- with(TRACK, KepertVerticalWindField(
rMax = rMax, vMax = vMax, vFm = vFms, thetaFm = thetaFms, f = f,
Rlam = Rlam, VZ = VZ, surface = params$surface,
dr_m = 50.0  # optional; defaults to 10 m
))
Ws <- GEO_land["lons"] / GEO_land["lons"]
values(Ws) <- -(UVKsWs[,4])
plot(Ws)#,range = c(-100,100))
Rlam
V
VZ
summary(VZ)
Rcpp::sourceCpp("verticalWind.cpp")
UVKsWs <- with(TRACK, KepertVerticalWindField(
rMax = rMax, vMax = vMax, vFm = vFms, thetaFm = thetaFms, f = f,
Rlam = Rlam, VZ = VZ, surface = params$surface,
dr_m = 50.0  # optional; defaults to 10 m
))
Ws <- GEO_land["lons"] / GEO_land["lons"]
values(Ws) <- (UVKsWs[,4])
plot(Ws)#,range = c(-100,100))
plot(Ws)#,range = c(-10,10))
plot(Ws),range = c(-10,10))
plot(Ws,range = c(-10,10))
sourceCpp("verticalWind.cpp")
UVKsWs <- with(TRACK, KepertVerticalWindField(
rMax = rMax, vMax = vMax, vFm = vFms, thetaFm = thetaFms, f = f,
Rlam = Rlam, VZ = VZ, surface = params$surface,
dr_m = 50.0  # optional; defaults to 10 m
))
Ws <- GEO_land["lons"] / GEO_land["lons"]
values(Ws) <- (UVKsWs[,4])
plot(Ws)#,range = c(-100,100))
values(Ws) <- (UVKsWs[,3])
plot(Ws)#,range = c(-100,100))
values(Ws) <- (UVKsWs[,1])
plot(Ws)#,range = c(-100,100))
a = NULL
missing(a)
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
suppressPackageStartupMessages(require(TCHazaRds))   # this package :)
suppressPackageStartupMessages(require(terra))       # spatial analysis
suppressPackageStartupMessages(require(rasterVis))   # enhanced raster visualization https://oscarperpinan.github.io/rastervis/
suppressPackageStartupMessages(require(sp))          # spatial methods and plotting
suppressPackageStartupMessages(require(knitr))       # formatted table
suppressPackageStartupMessages(require(raster))       # convert for raster plots
TCi = vect(cbind(c(154,154),c(-26.1,-26)),"lines",crs="epsg:4283") #track line segment
TCi$PRES = 950 #central pressure in hPa
#TCi$RMW = 40 #radius of maximum winds in km
TCi$ISO_TIME = "2022-10-04 20:00:00" #"%Y-%m-%d %H:%M:%S", tz = "UTC"
TCi$LON = geom(TCi)[1,3] #longitude
TCi$LAT = geom(TCi)[1,4] #latitude
TCi$STORM_SPD = perim(TCi)/(3*3600) #speed of the forward motion of the TC m/s
TCi$thetaFm = 90-returnBearing(TCi) #direction of the heading of the TC (Cartesian, clockwise from x axis)
TC <- vect(system.file("extdata/YASI/YASI.shp", package="TCHazaRds"))
TC$PRES <- TC$BOM_PRES #different agencies each provide a PRES, you need to chose one.
TC$STORM_SPD = TC$STORM_SPD/1.94 #provided as knots, convert to m/s
TC$thetaFm = 90-returnBearing(TC) #direction of the heading of the TC (Cartesian, clockwise from x axis)
TCi = TC[46]
paramsTable = read.csv(system.file("extdata/tuningParams/defult_params.csv",package = "TCHazaRds"))
knitr::kable(paramsTable,caption = "Parameter file")
r = rast(xmin = 145,xmax=149,ymin = -19,ymax = -16.5,resolution=.01)
values(r) = 0
#GEO_land = land_geometry(r,r)
#
land_v <- vect(system.file("extdata/OSM_500m_QLD/OSM_500m_QLD.shp", package="TCHazaRds"))
land_r = rasterize(land_v,r,touches=TRUE,background=0)
inland_proximity = terra::costDist(land_r,target = 0,scale=1)
GEO_land = land_geometry(land_r,inland_proximity)
#plot(inland_proximity,main = "Inland Distance (m)")
#plot(TC,add=TRUE)
ats = seq(0, 65, length=14)
HAZi = TCHazaRdsWindField(GEO_land = GEO_land,TC = TCi,paramsTable=paramsTable,returnWaves = TRUE)
library(raster)       # convert for raster plots
dummy = raster::raster()
TC_sp = list("sp.lines",as(TC,"Spatial"),col="black")
sp::spplot(HAZi,"Sw",at=ats,sp.layout = TC_sp,main = "Surface wind speed [m/s]")
ats = seq(0, 16, length=9)
sp::spplot(HAZi,"Hs0",at=ats,sp.layout = TC_sp,main = "Deep water significant wave height [m]")
ats = seq(0, 65, length=14)
if (.Platform$OS.type == "windows"){
UV = as(c(HAZi["Uw"],HAZi["Vw"]),"Raster") #need to convert back to raster
rasterVis::vectorplot(UV, isField='dXY', col.arrows='white', aspX=0.002,aspY=0.002,at=ats ,
colorkey=list(at=ats), par.settings=viridisTheme)+latticeExtra::layer(sp.lines(as(TC,"Spatial"),col="red"))
}
HAZ = TCHazaRdsWindFields(GEO_land=GEO_land,TC=TC,paramsTable=paramsTable)
sp::spplot(max(HAZ$Sw),at=ats,sp.layout = TC_sp)
plot(HAZ)
HAZ
HAZ$Pr
plot(HAZ$Pr)
HAZ = TCHazaRdsWindFields(GEO_land=GEO_land,TC=TC,paramsTable=paramsTable,returnWaves = TRUE)
HAZ = TCHazaRdsWindFields(GEO_land=GEO_land,TC=TC,paramsTable=paramsTable,returnWaves = TRUE)
sp::spplot(max(HAZ$Sw),at=ats,sp.layout = TC_sp)
sp::spplot(max(HAZ$Sw),at=ats,sp.layout = TC_sp)
GEO_land
plot(GEO_land)
TC
paramsTable
HAZ = TCHazaRdsWindFields(GEO_land=GEO_land,TC=TC,paramsTable=paramsTable,returnWaves = TRUE)
TC = crop(TC,as.polygons(ext(GEO_land)))
HAZ = TCHazaRdsWindFields(GEO_land=GEO_land,TC=TC,paramsTable=paramsTable,returnWaves = TRUE)
HAZ
HAZ$Pr
plot(HAZ$Pr)
devtools::check_win_devel()
devtools::check_win_devel()
devtools::check_win_devel()
devtools::check_win_devel()
devtools::check_win_devel()
devtools::check_rhub()
?rhubv2
rhub::check_for_cran()
rc_submit()
devtools::rc_submit()
rbub::rc_submit()
rhub::rc_submit()
rhub::rc_new_token()
rhub::rc_submit()
devtools::submit_cran()
